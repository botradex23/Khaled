import React, { useState } from 'react';
import { MLPredictionsDashboard } from "../components/ui/ml-predictions-dashboard";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "../components/ui/card";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "../components/ui/select";
import { Label } from "../components/ui/label";
import { Button } from "../components/ui/button";
import { Info, RefreshCw, Settings, Home, ArrowLeft } from 'lucide-react';
import { Badge } from "../components/ui/badge";
import { useLocation } from 'wouter';

// Simple header component
function SimpleHeader() {
  const [, navigate] = useLocation();
  
  return (
    <header className="fixed top-0 left-0 right-0 z-50 bg-background/95 backdrop-blur-sm border-b shadow-sm">
      <div className="container mx-auto px-4">
        <div className="flex h-16 items-center justify-between">
          <div className="flex items-center gap-2">
            <Button
              variant="ghost"
              size="icon"
              onClick={() => navigate('/')}
            >
              <Home className="h-5 w-5" />
            </Button>
            <h1 className="text-xl font-bold">CryptoTrade</h1>
          </div>
          <div className="flex items-center gap-2">
            <Button 
              variant="outline" 
              size="sm"
              className="gap-1"
              onClick={() => window.history.back()}
            >
              <ArrowLeft className="h-4 w-4" />
              Back
            </Button>
          </div>
        </div>
      </div>
    </header>
  );
}

export default function MLPredictionsPage() {
  const [interval, setInterval] = useState('4h');
  const [refreshRate, setRefreshRate] = useState('60000'); // 1 minute
  
  const refetchInterval = parseInt(refreshRate, 10);
  
  return (
    <div className="flex flex-col min-h-screen bg-background">
      <SimpleHeader />
      <main className="flex-grow container max-w-7xl pt-24 pb-12 px-4">
        <div className="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
          <div>
            <h1 className="text-3xl font-bold mb-2">ML Trading Predictions</h1>
            <p className="text-muted-foreground">
              Real-time trading signals generated by our advanced machine learning algorithms
            </p>
          </div>
          
          <div className="flex flex-col sm:flex-row gap-4">
            <Card className="p-1">
              <CardContent className="p-2 flex items-center gap-3">
                <div className="grid gap-1.5">
                  <Label htmlFor="interval">Timeframe</Label>
                  <Select 
                    value={interval}
                    onValueChange={setInterval}
                  >
                    <SelectTrigger id="interval" className="w-[100px]">
                      <SelectValue placeholder="Interval" />
                    </SelectTrigger>
                    <SelectContent>
                      <SelectItem value="1h">1 Hour</SelectItem>
                      <SelectItem value="4h">4 Hours</SelectItem>
                      <SelectItem value="1d">1 Day</SelectItem>
                    </SelectContent>
                  </Select>
                </div>
                
                <div className="grid gap-1.5">
                  <Label htmlFor="refresh">Refresh Rate</Label>
                  <Select
                    value={refreshRate}
                    onValueChange={setRefreshRate}
                  >
                    <SelectTrigger id="refresh" className="w-[120px]">
                      <SelectValue placeholder="Refresh Rate" />
                    </SelectTrigger>
                    <SelectContent>
                      <SelectItem value="30000">30 Seconds</SelectItem>
                      <SelectItem value="60000">1 Minute</SelectItem>
                      <SelectItem value="300000">5 Minutes</SelectItem>
                    </SelectContent>
                  </Select>
                </div>
              </CardContent>
            </Card>
          </div>
        </div>
        
        <div className="grid grid-cols-1 gap-6">
          <div className="bg-primary/5 border border-primary/10 rounded-lg p-4 flex items-start gap-3">
            <Info className="h-5 w-5 text-primary mt-0.5 flex-shrink-0" />
            <div>
              <h3 className="font-medium mb-1">About ML Predictions</h3>
              <p className="text-sm text-muted-foreground">
                These predictions are generated using XGBoost machine learning models trained on historical market data. 
                The models analyze various technical indicators including RSI, EMA, MACD, and price patterns to predict 
                potential market movements. Each prediction includes a confidence score representing the model's certainty.
              </p>
              <div className="flex flex-wrap gap-2 mt-3">
                <Badge variant="outline" className="text-xs">
                  Model Accuracy: BTCUSDT ~81.58%
                </Badge>
                <Badge variant="outline" className="text-xs">
                  Model Accuracy: ETHUSDT ~67.11%
                </Badge>
                <Badge variant="outline" className="text-xs">
                  Real-time data from Binance API
                </Badge>
              </div>
            </div>
          </div>
          
          <MLPredictionsDashboard 
            symbols={['BTCUSDT', 'ETHUSDT']}
            interval={interval}
            refetchInterval={refetchInterval}
          />
        </div>
      </main>
    </div>
  );
}